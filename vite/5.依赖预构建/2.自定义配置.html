<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.43">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/image/favicon.ico"><title>依赖预构建 | </title><meta name="description" content="">
    <link rel="modulepreload" href="/vp-blob.io/assets/app.28445bf9.js"><link rel="modulepreload" href="/vp-blob.io/assets/2.自定义配置.html.0bffe771.js"><link rel="modulepreload" href="/vp-blob.io/assets/2.自定义配置.html.299f370c.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.8f018029.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.98776873.js"><link rel="prefetch" href="/vp-blob.io/assets/1 调试 Vue 项目.html.ec84774a.js"><link rel="prefetch" href="/vp-blob.io/assets/2 VsCode Chrome Debugger 断点映射原理.html.84c58d00.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.fb44c11d.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.04557333.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.e4e771ef.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.64a103a2.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.3013be87.js"><link rel="prefetch" href="/vp-blob.io/assets/a.项目环境搭建.html.f33a1b79.js"><link rel="prefetch" href="/vp-blob.io/assets/b.基础类型.html.f0357039.js"><link rel="prefetch" href="/vp-blob.io/assets/c.字面量类型与枚举.html.d4018bdd.js"><link rel="prefetch" href="/vp-blob.io/assets/d.函数重载与Class.html.fc637112.js"><link rel="prefetch" href="/vp-blob.io/assets/e.any、unknown、never.html.657af7d7.js"><link rel="prefetch" href="/vp-blob.io/assets/f.类型工具(part 1).html.af7e2c7e.js"><link rel="prefetch" href="/vp-blob.io/assets/g.类型工具(part 2).html.885a698a.js"><link rel="prefetch" href="/vp-blob.io/assets/h.泛型.html.f1da3f4b.js"><link rel="prefetch" href="/vp-blob.io/assets/i.结构化类型系统：类型兼容性判断的幕后.html.71e96b0a.js"><link rel="prefetch" href="/vp-blob.io/assets/j.类型系统层级.html.a8066bef.js"><link rel="prefetch" href="/vp-blob.io/assets/k.条件类型与infer.html.47b96db6.js"><link rel="prefetch" href="/vp-blob.io/assets/l.工具类型.html.a39bfc1a.js"><link rel="prefetch" href="/vp-blob.io/assets/m.反向类型推导.html.2295a28e.js"><link rel="prefetch" href="/vp-blob.io/assets/n.协变与逆变的比较.html.3fb1f527.js"><link rel="prefetch" href="/vp-blob.io/assets/o.进阶.html.d26307e6.js"><link rel="prefetch" href="/vp-blob.io/assets/p.模板字符串.html.d7704ccc.js"><link rel="prefetch" href="/vp-blob.io/assets/q.字符串进阶.html.a198ccc8.js"><link rel="prefetch" href="/vp-blob.io/assets/r.类型声明命名空间.html.d5d366e2.js"><link rel="prefetch" href="/vp-blob.io/assets/s.装饰器.html.9962dce2.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.fe25b76a.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.a8456586.js"><link rel="prefetch" href="/vp-blob.io/assets/邂逅.html.d6877f1b.js"><link rel="prefetch" href="/vp-blob.io/assets/Button.html.16fd9c5f.js"><link rel="prefetch" href="/vp-blob.io/assets/InputNumber.html.a8ad5ee0.js"><link rel="prefetch" href="/vp-blob.io/assets/Slider.html.e57931a0.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.224c5d9e.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.9483b910.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.21885604.js"><link rel="prefetch" href="/vp-blob.io/assets/1.环境搭建.html.afebf168.js"><link rel="prefetch" href="/vp-blob.io/assets/2.项目初始化.html.fbc2f79f.js"><link rel="prefetch" href="/vp-blob.io/assets/1.样式方案的意义.html.f5f2a306.js"><link rel="prefetch" href="/vp-blob.io/assets/1.图片加载.html.a8e3ed93.js"><link rel="prefetch" href="/vp-blob.io/assets/2.svg组件方式加载.html.4761e1bb.js"><link rel="prefetch" href="/vp-blob.io/assets/3.JSON加载.html.645f59cf.js"><link rel="prefetch" href="/vp-blob.io/assets/4.WebWorker脚本.html.71743a0c.js"><link rel="prefetch" href="/vp-blob.io/assets/5.WebAssembly文件.html.06f977a3.js"><link rel="prefetch" href="/vp-blob.io/assets/6.生产环境处理.html.ffbf235f.js"><link rel="prefetch" href="/vp-blob.io/assets/7.单文件or内联.html.03ab869d.js"><link rel="prefetch" href="/vp-blob.io/assets/8.图片压缩.html.24317708.js"><link rel="prefetch" href="/vp-blob.io/assets/9.雪碧图优化.html.21818278.js"><link rel="prefetch" href="/vp-blob.io/assets/1.预构建起因.html.a0e1348b.js"><link rel="prefetch" href="/vp-blob.io/assets/1.Esbuild介绍.html.88fb9194.js"><link rel="prefetch" href="/vp-blob.io/assets/2-1.快速上手.html.623e016f.js"><link rel="prefetch" href="/vp-blob.io/assets/2-2.命令行.html.f71f240c.js"><link rel="prefetch" href="/vp-blob.io/assets/1.快速上手.html.70643a0d.js"><link rel="prefetch" href="/vp-blob.io/assets/2.常用配置.html.fcb179b9.js"><link rel="prefetch" href="/vp-blob.io/assets/1.CSS 预处理器.html.a4126bf7.js"><link rel="prefetch" href="/vp-blob.io/assets/2.CSS Modules.html.b9b1e0ca.js"><link rel="prefetch" href="/vp-blob.io/assets/3.PostCSS.html.851b045e.js"><link rel="prefetch" href="/vp-blob.io/assets/4.CSS In JS.html.60e43a8c.js"><link rel="prefetch" href="/vp-blob.io/assets/1.初始化.html.761e4995.js"><link rel="prefetch" href="/vp-blob.io/assets/1.Build API.html.4c0328e0.js"><link rel="prefetch" href="/vp-blob.io/assets/2.serve API.html.5f3cb86a.js"><link rel="prefetch" href="/vp-blob.io/assets/3.Transform API.html.8ff82f5e.js"><link rel="prefetch" href="/vp-blob.io/assets/1.基本概念.html.7f1b0f8b.js"><link rel="prefetch" href="/vp-blob.io/assets/1.CDN依赖拉取插件.html.b86014e5.js"><link rel="prefetch" href="/vp-blob.io/assets/2.实现html构建插件.html.dba571f1.js"><link rel="prefetch" href="/vp-blob.io/assets/5-1.Windi CSS.html.c009c8d1.js"><link rel="prefetch" href="/vp-blob.io/assets/5-2.Tailwind CSS.html.06394c55.js"><link rel="prefetch" href="/vp-blob.io/assets/1.onResolve和onLoad.html.cd077274.js"><link rel="prefetch" href="/vp-blob.io/assets/2.onStart和onEnd.html.4933004a.js"><link rel="prefetch" href="/vp-blob.io/assets/404.html.93146c89.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.0356a730.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.9f9140e5.js"><link rel="prefetch" href="/vp-blob.io/assets/1 调试 Vue 项目.html.98256e4c.js"><link rel="prefetch" href="/vp-blob.io/assets/2 VsCode Chrome Debugger 断点映射原理.html.b052bd8a.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.3e37b7e7.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.6ff36268.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.b6b2b9e2.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.c874a8b5.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.c3e042f2.js"><link rel="prefetch" href="/vp-blob.io/assets/a.项目环境搭建.html.7a317f56.js"><link rel="prefetch" href="/vp-blob.io/assets/b.基础类型.html.2a865dab.js"><link rel="prefetch" href="/vp-blob.io/assets/c.字面量类型与枚举.html.311f0358.js"><link rel="prefetch" href="/vp-blob.io/assets/d.函数重载与Class.html.cf697cfd.js"><link rel="prefetch" href="/vp-blob.io/assets/e.any、unknown、never.html.6fb392b7.js"><link rel="prefetch" href="/vp-blob.io/assets/f.类型工具(part 1).html.398b4e97.js"><link rel="prefetch" href="/vp-blob.io/assets/g.类型工具(part 2).html.037aad7d.js"><link rel="prefetch" href="/vp-blob.io/assets/h.泛型.html.1bd949ed.js"><link rel="prefetch" href="/vp-blob.io/assets/i.结构化类型系统：类型兼容性判断的幕后.html.52ca17dd.js"><link rel="prefetch" href="/vp-blob.io/assets/j.类型系统层级.html.f34fa417.js"><link rel="prefetch" href="/vp-blob.io/assets/k.条件类型与infer.html.e44fb0eb.js"><link rel="prefetch" href="/vp-blob.io/assets/l.工具类型.html.a09badfd.js"><link rel="prefetch" href="/vp-blob.io/assets/m.反向类型推导.html.62415c6a.js"><link rel="prefetch" href="/vp-blob.io/assets/n.协变与逆变的比较.html.037e5a5d.js"><link rel="prefetch" href="/vp-blob.io/assets/o.进阶.html.013365b5.js"><link rel="prefetch" href="/vp-blob.io/assets/p.模板字符串.html.3b025d3c.js"><link rel="prefetch" href="/vp-blob.io/assets/q.字符串进阶.html.e3e976e6.js"><link rel="prefetch" href="/vp-blob.io/assets/r.类型声明命名空间.html.297e089b.js"><link rel="prefetch" href="/vp-blob.io/assets/s.装饰器.html.861f9241.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.f748203e.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.18ee491b.js"><link rel="prefetch" href="/vp-blob.io/assets/邂逅.html.fcd2c4fb.js"><link rel="prefetch" href="/vp-blob.io/assets/Button.html.9061575a.js"><link rel="prefetch" href="/vp-blob.io/assets/InputNumber.html.a8454023.js"><link rel="prefetch" href="/vp-blob.io/assets/Slider.html.0e8811b9.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.c4c65b97.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.547bbfb0.js"><link rel="prefetch" href="/vp-blob.io/assets/index.html.3a04f0a9.js"><link rel="prefetch" href="/vp-blob.io/assets/1.环境搭建.html.5e39c00a.js"><link rel="prefetch" href="/vp-blob.io/assets/2.项目初始化.html.8d1df225.js"><link rel="prefetch" href="/vp-blob.io/assets/1.样式方案的意义.html.0300e3da.js"><link rel="prefetch" href="/vp-blob.io/assets/1.图片加载.html.4367c6e7.js"><link rel="prefetch" href="/vp-blob.io/assets/2.svg组件方式加载.html.52adde68.js"><link rel="prefetch" href="/vp-blob.io/assets/3.JSON加载.html.1119a5b8.js"><link rel="prefetch" href="/vp-blob.io/assets/4.WebWorker脚本.html.8c2848ad.js"><link rel="prefetch" href="/vp-blob.io/assets/5.WebAssembly文件.html.343d643e.js"><link rel="prefetch" href="/vp-blob.io/assets/6.生产环境处理.html.cc2b7662.js"><link rel="prefetch" href="/vp-blob.io/assets/7.单文件or内联.html.8ecb2353.js"><link rel="prefetch" href="/vp-blob.io/assets/8.图片压缩.html.1063515b.js"><link rel="prefetch" href="/vp-blob.io/assets/9.雪碧图优化.html.8722a081.js"><link rel="prefetch" href="/vp-blob.io/assets/1.预构建起因.html.44ede00a.js"><link rel="prefetch" href="/vp-blob.io/assets/1.Esbuild介绍.html.b1a0b6cc.js"><link rel="prefetch" href="/vp-blob.io/assets/2-1.快速上手.html.83703e49.js"><link rel="prefetch" href="/vp-blob.io/assets/2-2.命令行.html.3139a078.js"><link rel="prefetch" href="/vp-blob.io/assets/1.快速上手.html.c6c4dc0a.js"><link rel="prefetch" href="/vp-blob.io/assets/2.常用配置.html.036cd62d.js"><link rel="prefetch" href="/vp-blob.io/assets/1.CSS 预处理器.html.cfc6577d.js"><link rel="prefetch" href="/vp-blob.io/assets/2.CSS Modules.html.f78bbe87.js"><link rel="prefetch" href="/vp-blob.io/assets/3.PostCSS.html.be63d1c8.js"><link rel="prefetch" href="/vp-blob.io/assets/4.CSS In JS.html.93776a99.js"><link rel="prefetch" href="/vp-blob.io/assets/1.初始化.html.b6fed70c.js"><link rel="prefetch" href="/vp-blob.io/assets/1.Build API.html.bbc94483.js"><link rel="prefetch" href="/vp-blob.io/assets/2.serve API.html.a38026e9.js"><link rel="prefetch" href="/vp-blob.io/assets/3.Transform API.html.92ecacce.js"><link rel="prefetch" href="/vp-blob.io/assets/1.基本概念.html.644e2aab.js"><link rel="prefetch" href="/vp-blob.io/assets/1.CDN依赖拉取插件.html.fe27efa4.js"><link rel="prefetch" href="/vp-blob.io/assets/2.实现html构建插件.html.bd744455.js"><link rel="prefetch" href="/vp-blob.io/assets/5-1.Windi CSS.html.b7f872e5.js"><link rel="prefetch" href="/vp-blob.io/assets/5-2.Tailwind CSS.html.53627ba1.js"><link rel="prefetch" href="/vp-blob.io/assets/1.onResolve和onLoad.html.17ca2b9d.js"><link rel="prefetch" href="/vp-blob.io/assets/2.onStart和onEnd.html.0ceab273.js"><link rel="prefetch" href="/vp-blob.io/assets/404.html.a799acdf.js"><link rel="prefetch" href="/vp-blob.io/assets/404.008f7f9a.js"><link rel="prefetch" href="/vp-blob.io/assets/Layout.f041014c.js"><link rel="prefetch" href="/vp-blob.io/assets/Document.7ddbfa27.js"><link rel="prefetch" href="/vp-blob.io/assets/DocumentIntroduction.642e8662.js"><link rel="prefetch" href="/vp-blob.io/assets/FooBar.72140e24.js"><link rel="prefetch" href="/vp-blob.io/assets/MyNav.c0863aa2.js"><link rel="prefetch" href="/vp-blob.io/assets/TypeScriptPrimitiveAndObject.723d323e.js"><link rel="prefetch" href="/vp-blob.io/assets/aMark.e9a27668.js"><link rel="prefetch" href="/vp-blob.io/assets/MyNote.c64d23bd.js"><link rel="prefetch" href="/vp-blob.io/assets/MyHome.27c67e38.js">
    <link rel="stylesheet" href="/vp-blob.io/assets/style.f819ef42.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vp-blob.io/" class=""><img class="logo" src="/vp-blob.io/image/favicon.ico" alt><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/vp-blob.io/vite/" class="router-link-active" aria-label="vite"><!--[--><!--]--> vite <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vp-blob.io/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vp-blob.io/debug/" class="" aria-label="调试"><!--[--><!--]--> 调试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="笔记"><span class="title">笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="笔记"><span class="title">笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/documents/introduction" class="" aria-label="分享"><!--[--><!--]--> 分享 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/wxProgram/" class="" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/essay" class="" aria-label="八股文"><!--[--><!--]--> 八股文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/cqc-hub/vp-blob.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/vp-blob.io/vite/" class="router-link-active" aria-label="vite"><!--[--><!--]--> vite <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vp-blob.io/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vp-blob.io/debug/" class="" aria-label="调试"><!--[--><!--]--> 调试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="笔记"><span class="title">笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="笔记"><span class="title">笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/documents/introduction" class="" aria-label="分享"><!--[--><!--]--> 分享 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/wxProgram/" class="" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vp-blob.io/essay" class="" aria-label="八股文"><!--[--><!--]--> 八股文 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/cqc-hub/vp-blob.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">依赖预构建 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#自动开启" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动开启"><!--[--><!--]--> 自动开启 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#手动开启" class="router-link-active router-link-exact-active sidebar-item" aria-label="手动开启"><!--[--><!--]--> 手动开启 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#自定义配置的详解" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义配置的详解"><!--[--><!--]--> 自定义配置的详解 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#entries-入口文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="entries 入口文件"><!--[--><!--]--> entries 入口文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#include-添加一些依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="include 添加一些依赖"><!--[--><!--]--> include 添加一些依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vp-blob.io/vite/5.%E4%BE%9D%E8%B5%96%E9%A2%84%E6%9E%84%E5%BB%BA/2.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE.html#自定义-esbulild-行为" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义 Esbulild 行为"><!--[--><!--]--> 自定义 Esbulild 行为 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="依赖预构建" tabindex="-1"><a class="header-anchor" href="#依赖预构建" aria-hidden="true">#</a> 依赖预构建</h1><p>vite 中有两种开启依赖预构建的方式</p><h2 id="自动开启" tabindex="-1"><a class="header-anchor" href="#自动开启" aria-hidden="true">#</a> 自动开启</h2><p>在项目启动成功后, 你可以在根目录下的 <code>node_modules</code> 中 发现 <code>.vite</code> 目录, 这就是预构建产物存放的目录</p><p>在浏览器访问页面后，打开 Dev Tools 中的网络调试面板，你可以发现第三方包的引入路径已经路径被重写，定向到预构建产物文件中, 并且对于依赖的请求结果, vite 的 devServer 会设置一年的强缓存 <img src="https://phsdevoss.eheren.com/pcloud/phs3.0/test/Snipaste_2023-04-06_14-17-45.jpg" alt="设置一年的强缓存"></p><p>可以看到过期时间(31536000/60/60/24 = 365) 一年, 表示缓存过期前浏览器对这个构建产物的请求不会再经过 vite DevServer, 直接使用缓存结果</p><p>当然, 除了 http 缓存, vite 还设置了本地文件系统的缓存, 所有的构建产物缓存默认在 <code>node_modules/.vite</code> 目录中. 如果以下三个地方都没有改动, <strong>vite 将一直使用缓存文件</strong>:</p><ul><li>package.json 的 <code>dependencies</code> 字段</li><li>各种包管理器的lock文件</li><li><code>optimizeDeps</code> 配置内容</li></ul><h2 id="手动开启" tabindex="-1"><a class="header-anchor" href="#手动开启" aria-hidden="true">#</a> 手动开启</h2><p>上面提到了预构建中本地文件系统的产物缓存机制, 而少数情况下我们不希望用本地的缓存文件, 比如需要调试某个包的预构建结果, 建议使用下面任意一种方法清除缓存:</p><ul><li>删除 <code>node_modules/.vite</code> 目录</li><li>在 vite 配置中, 将 <code>server.force</code> 设为 <code>true</code> (vite 3.0 中配置项有所更新, 需要将 <code>optimizeDeps.force</code> 设为 <code>true</code>)</li><li>命令行执行 <code>npx vite --force</code> 或者 <code>npx vite optimize</code></li></ul><blockquote><p>vite 项目的启动可以分为两步, 第一步是依赖预构建, 第二步才是devServer的启动, <code>npx vite optimize</code> 相比其他的方案, 仅仅完成第一步的功能</p></blockquote><h2 id="自定义配置的详解" tabindex="-1"><a class="header-anchor" href="#自定义配置的详解" aria-hidden="true">#</a> 自定义配置的详解</h2><p>vite 将预构建相关的配置项都集中在 <code>optimizeDeps</code> 属性上</p><h3 id="entries-入口文件" tabindex="-1"><a class="header-anchor" href="#entries-入口文件" aria-hidden="true">#</a> entries 入口文件</h3><p>通过这个参数可以自定义预构建入口文件.</p><p>实际上, 在项目第一次启动时候, vite 会默认抓去项目中所有的 html文件(如当前脚手架中的 <code>index.html</code>), 将html 作为应用入口, 然后根据入口文件扫描项目中用到的第三方依赖, 最后对这些文件逐个进行编译.</p><p>那么, 当默认扫描 html 文件的行为无法满足需求的时候, 比如项目入口为 <code>vue</code> 格式文件的时候, 你可以通过 <code>entries</code> 参数来配置:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>

<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    entries<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;./src/main.vue&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 支持 glob 语法(https://github.com/mrmlnc/fast-glob)</span>
      <span class="token string">&#39;**/*.vue&#39;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>不光是 <code>.vue</code> 文件, vite 同时还支持各种格式入口, 包括: html, svelte, astro, js, jsx, ts, tsx. 可以看到, 只要可能存在 <code>import</code> 语句的地方, vite 都可以解析, 并通过内置的扫描机制搜集项目中用到的依赖, 通用性很强</p><h3 id="include-添加一些依赖" tabindex="-1"><a class="header-anchor" href="#include-添加一些依赖" aria-hidden="true">#</a> include 添加一些依赖</h3><p>除了 entries, <code>include</code> 也是一个很常用的配置, 它决定了可以强制预构建的依赖项, 使用方式也简单:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>
<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;lodash-es&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>它使用上并不难, 真正难得地方在于, 如何找到使用它的场景:</p><p>vite 可以根据应用入口(<code>entries</code>) 自动收集依赖, 然后进行预构建, 这是不是说明 vite 可以百分百准确的收集到所有的依赖呢? 事实上并不是, 某些情况下 vite 默认的扫描行为并不完全可靠, 这时候就需要联合配置 <code>include</code> 来达到完美的预构建效果了</p><p>下面我们来梳理下到底有哪些需要手动配置 <code>include</code>:</p><h4 id="场景一-动态import" tabindex="-1"><a class="header-anchor" href="#场景一-动态import" aria-hidden="true">#</a> 场景一: 动态import</h4><p>在某些动态import 的场景下, 由于 vite 天然按需加载的特性, 经常会导致某些依赖只能在运行时被识别出来.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> objectAssign <span class="token keyword">from</span> <span class="token string">&quot;object-assign&quot;</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>objectAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">importModule</span> <span class="token operator">=</span> <span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./locales/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">importModule</span><span class="token punctuation">(</span><span class="token string">&quot;zh_CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在这个例子中, 动态 import 的路径只有在运行时候才能确定, 无法在预构建阶段被扫描出来, 因此, 我们在访问项目时控制台会出现这样的日志信息:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>vite<span class="token punctuation">]</span> <span class="token keyword">new</span> dependencies found<span class="token operator">:</span> object<span class="token operator">-</span>assign<span class="token punctuation">,</span> updating<span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> ✨ dependencies updated<span class="token punctuation">,</span> reloading page<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这段log的意思: vite 运行时候发现了新的依赖, 随之重新进行依赖预构建, 并刷新页面. 这个过程也叫<strong>二次预构建</strong>. 在一些比较复杂的项目中, 这个过程会进行很多次, 比如这个:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">[</span>vite<span class="token punctuation">]</span> <span class="token keyword">new</span> dependencies found<span class="token operator">:</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>icons<span class="token operator">/</span><span class="token class-name">Dehaze</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">Box</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">Checkbox</span><span class="token punctuation">,</span> updating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> ✨ dependencies updated<span class="token punctuation">,</span> reloading page<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> <span class="token keyword">new</span> dependencies found<span class="token operator">:</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">Dialog</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">DialogActions</span><span class="token punctuation">,</span> updating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> ✨ dependencies updated<span class="token punctuation">,</span> reloading page<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> <span class="token keyword">new</span> dependencies found<span class="token operator">:</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">Accordion</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@material</span><span class="token operator">-</span>ui<span class="token operator">/</span>core<span class="token operator">/</span><span class="token class-name">AccordionSummary</span><span class="token punctuation">,</span> updating<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>vite<span class="token punctuation">]</span> ✨ dependencies updated<span class="token punctuation">,</span> reloading page<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然而, 二次预构建的成本也比较大, 我们不仅需要吧预构建的流程重新运行一边, 还得重新刷新页面, 并且需要重新请求所有模块. 在大型项目中, 这个<strong>过程会严重 拖慢应用的加载速度</strong>, 因此, 我们需要尽力避免运行时候的<strong>二次预构建</strong>, 比如上面的例子:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>  <span class="token comment">// vite.config.ts</span>
  <span class="token punctuation">{</span>
    optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 按需加载的依赖都可以声明到这个数组里</span>
        <span class="token string">&#39;object-assign&#39;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="场景二-某些包被手动-exclude" tabindex="-1"><a class="header-anchor" href="#场景二-某些包被手动-exclude" aria-hidden="true">#</a> 场景二: 某些包被手动 exclude</h4><p><code>exclude</code> 是 <code>optimizeDeps</code> 中的另一个配置项, 与 <code>include</code> 相对, 用于将某些依赖从预构建的过程中排除. 不过这个配置不常用, 也不推荐使用. 如果真的遇到了要在预构建中排除某个包的情况, 需要注意 <code>它所依赖的包</code> 是否具有 ESM 格式, 比如这个包:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>
<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@loadable/component&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>启动后会发现浏览器控制台报错了:</p><p><img src="https://phsdevoss.eheren.com/pcloud/phs3.0/test/op-mark_3024_0_0_0.webp" alt="err"></p><p>这是为啥? 刚刚手动 exclude 的包 <code>@loadable/component</code> 本身具有 ESM 格式的产物, 但他的某个依赖项 <code>hoist-non-react-statics</code> 的产物并没有提供 ESM 格式, 导致运行时加载失败.</p><p>这个时候 <code>include</code> 配置就派上用场了, 我们可以强制对 <code>hoist-non-react-statics</code> 这个间接依赖进行预构建:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>
<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@loadable/component&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 间接依赖的声明语法，通过`&gt;`分开, 如`a &gt; b`表示 a 中依赖的 b</span>
      <span class="token string">&#39;@loadable/component &gt; hoist-non-react-statics&#39;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在 <code>include</code>参数重, 我们将所有不具备 ESM 格式的产物包都声明一边, 这样再次启动项目就没有问题了.</p><h3 id="自定义-esbulild-行为" tabindex="-1"><a class="header-anchor" href="#自定义-esbulild-行为" aria-hidden="true">#</a> 自定义 Esbulild 行为</h3><p>vite 提供了 <code>esbuildOptions</code> 参数来让我们自定义 Esbuild 本身的配置, 常用的场景是加入一些 Esbuild 插件:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>
<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    esbuildOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 加入 Esbuild 插件</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个配置主要是处理一些特殊情况, 如某个第三方包本身的代码出现问题了:</p><h4 id="第三方包出现问题了怎么办" tabindex="-1"><a class="header-anchor" href="#第三方包出现问题了怎么办" aria-hidden="true">#</a> 第三方包出现问题了怎么办?</h4><p>我们无法保证第三方包的代码质量, 在某些情况下我们会遇到莫名的第三方库报错. 这里有一个案例 --<code>react-virtualized</code>库, 这个库被许多组件库用到, 但它的 ESM 格式产物有明显的问题, 会在 vite 预构建中抛出这个错误</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code>node_modules<span class="token operator">/</span><span class="token operator">-</span>ppm<span class="token operator">/</span>registry<span class="token punctuation">.</span>npmmirror<span class="token punctuation">.</span>com<span class="token operator">+</span>react<span class="token operator">-</span>virtualized@<span class="token number">9.22</span><span class="token number">.3</span>_react<span class="token operator">-</span>dom@<span class="token number">17.0</span><span class="token number">.1</span><span class="token operator">+</span>react@<span class="token number">17.0</span><span class="token number">.1</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>react<span class="token operator">-</span>virtualized<span class="token operator">/</span>dist<span class="token operator">/</span>es<span class="token operator">/</span>WindowScroller<span class="token operator">/</span>utils<span class="token operator">/</span>onScroll<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">74</span><span class="token operator">:</span><span class="token number">9</span><span class="token operator">:</span>error<span class="token operator">:</span>Nomatchingexportin<span class="token string">&quot;no _modules/.ppm/registry.npmmirror.com+react-virtualized@9.22.3_react-dom@17.0.1+react@17.0.1/node_modules/react-virtualized/dist/es/WindowScroller/WindowScroller.js&quot;</span>forimport<span class="token string">&quot;bpfrpt_proptype_WindowScroller&quot;</span>
import <span class="token punctuation">{</span> bpfrpt_proptype_WindowScroller <span class="token punctuation">}</span> from <span class="token string">&quot;../WindowScroller-js&quot;</span><span class="token punctuation">,</span>

error when starting dev server<span class="token operator">:</span>
Error<span class="token operator">:</span> Build failed with <span class="token number">1</span> error<span class="token operator">:</span>
node_modules<span class="token operator">/</span><span class="token operator">-</span>ppm<span class="token operator">/</span>registry<span class="token punctuation">.</span>npmmirror<span class="token punctuation">.</span>com<span class="token operator">+</span>react<span class="token operator">-</span>virtualized@<span class="token number">9.22</span><span class="token number">.3</span>_react<span class="token operator">-</span>dom@<span class="token number">17.0</span><span class="token number">.1</span><span class="token operator">+</span>react@<span class="token number">17.0</span><span class="token number">.1</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>react<span class="token operator">-</span>virtualized<span class="token operator">/</span>dist<span class="token operator">/</span>es<span class="token operator">/</span>WindowScroller<span class="token operator">/</span>utils<span class="token operator">/</span>onScroll<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>原因是这个库的 ES 产物莫名其妙多出来一行无用的代码:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// WindowScroller.js 并没有导出这个模块</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bpfrpt_proptype_WindowScroller <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../WindowScroller.js&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其实我们并不需要这行代码，但它却导致 Esbuild 预构建的时候直接报错退出了。那这一类的问题如何解决呢？</p><h5 id="_1-改第三方库代码" tabindex="-1"><a class="header-anchor" href="#_1-改第三方库代码" aria-hidden="true">#</a> 1. 改第三方库代码</h5><p>首先, 我们能想到的直接思路是<strong>修改第三方库的代码</strong>, 不过这会带来团队协作的问题, 你的改动需要同步带团队所有成员, 比较麻烦.</p><p>好在, 我们可以使用 <code>patch-package</code> 这个库来解决这类问题. 一方面, 他能记录第三方库代码的改动, 另一方面也能将改动同步到团队 的每一个成员</p><p><code>patch-package</code> 只支持 npm 和 yarn, 而不支持 pnpm, 不过社区中已经提供了支持 <code>pnpm</code> 的版本, 我们来安装下相应的包</p><div class="language-m ext-m line-numbers-mode"><pre class="language-m"><code>pnpm i @milahu/patch-package -D
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>注意: 要改动的包在 package.json 中必须声明确定的版本，不能有~或者^的前缀。</p></blockquote><p>接着，我们进入第三方库的代码中进行修改，先删掉无用的 import 语句，再在命令行输入:</p><div class="language-m ext-m line-numbers-mode"><pre class="language-m"><code>npx patch-package react-virtualized
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>现在根目录会多出 <code>patches</code> 目录记录第三方包内容的更改, 随后我们在 <code>package.json</code> 的 <code>scripts</code> 中增加如下内容:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;patch-package&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样一来, 每次安装依赖的时候都会通过 <code>postinstall</code> 脚本自动应用 patches 的修改, 解决了团队协作的问题</p><h5 id="_2-加入-esbuild-插件" tabindex="-1"><a class="header-anchor" href="#_2-加入-esbuild-插件" aria-hidden="true">#</a> 2. 加入 Esbuild 插件</h5><p>第二种方法是通过 Esbuild 插件修改指定模块的内容</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> esBuildPlugin <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;react-virtualized-patch&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>build<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    build<span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        filter<span class="token operator">:</span>
          <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">react-virtualized\/dist\/es\/WindowScroller\/utils\/onScroll.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">async</span> <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          contents<span class="token operator">:</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
            <span class="token string">&#39;import { bpfrpt_proptype_WindowScroller } from &quot;../WindowScroller.js&quot;;&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token punctuation">{</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    esbuildOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">[</span>esBuildPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/cqc-hub/vp-blob.io/tree/master/docs/vite/5.依赖预构建/2.自定义配置.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/vp-blob.io/assets/app.28445bf9.js" defer></script>
  </body>
</html>
